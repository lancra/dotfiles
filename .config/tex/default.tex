\usepackage{xcolor}

\lstset{
    backgroundcolor=\color{black!10},
    basicstyle=\ttfamily,
    breakatwhitespace=true,
    breakautoindent=true,
    breaklines=true,
    captionpos=b,
    linewidth=\textwidth,
    numbers=left,
    numbersep=5pt,
    numberstyle=\footnotesize,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    stepnumber=2,
    tabsize=2
}

\usepackage{float}
\let\origfigure\figure
\let\endorigfigure\endfigure
\renewenvironment{figure}[1][2] {
    \expandafter\origfigure\expandafter[H]
} {
    \endorigfigure
}
